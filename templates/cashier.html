<html>
    <head>
        <title>cash register</title>
    </head>
    <style>
        table {
            margin: 0 auto;
            float: left;
            width: 70%;
        }

        .button {
            width: 100px;
            height: 100px;
            border: none;
            cursor: pointer;
        }

        .button img {
            width: 100%;
            height: 100%;
        }

        .queue {
            float: left;
            width: 30%;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
    <body>
        <div class="queue">
            <h1>Queue</h1>

            <table>
                <tr>
                    <th>Order #</th>
                    <th>Type</th>
                    <th>Qty</th>
                    <th>Action</th>
                </tr>
                {% for (type, qty) in pizzas %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ type }}</td>
                        <td>{{ qty }}</td>
                        <td><button onclick="removeFromQueue({{ loop.index }})">Remove</button></td>
                    </tr>
                {% endfor %}
            </table>
        </div>
        <br><br>
        <table style="margin: 0 auto;">
            <tr>
                <td>
                    <a href="#" class="button" onclick="addToQueue('cocacola', 1)">
                        <img src="{{ url_for('static', filename='cocacola.jpeg') }}" alt="cocacola" style="width: 400px; height: 300px;">
                    </a>
                </td>
                <td>
                    <a href="#" class="button" onclick="addToQueue('marinara', 1)">
                        <img src="{{ url_for('static', filename='marinara.webp') }}" alt="marinara pizza" style="width: 400px; height: 300px;">
                    </a>
                </td>
                <td>
                    <a href="#" class="button" onclick="addToQueue('margherita', 1)">
                        <img src="{{ url_for('static', filename='margherita.webp') }}" alt="margherita pizza" style="width: 400px; height: 300px;">
                    </a>
                </td>
            </tr>
            <tr>
                <td>
                    <a href="#" class="button" onclick="addToQueue('water', 1)">
                        <img src="{{ url_for('static', filename='water.jpeg') }}" alt="water" style="width: 400px; height: 300px;">
                    </a>
                </td>
                <td>
                    <a href="#" class="button" onclick="addToQueue('meatlovers', 1)">
                        <img src="{{ url_for('static', filename='meatlovers.jpg') }}" alt="meatlovers pizza" style="width: 400px; height: 300px;">
                    </a>
                </td>
                <td>
                    <a href="#" class="button" onclick="addToQueue('pepperoni', 1)">
                        <img src="{{ url_for('static', filename='pepperoni.jpg') }}" alt="pepperoni pizza" style="width: 400px; height: 300px;">
                    </a>
                </td>
            </tr>
        </table>

        <form action="/register" method="post">
            <label>Item:</label><br>
            <input type="text" name="type"><br><br>

            <label>Qty:</label><br>
            <input type="number" name="Qty"><br><br><br>

            <input type="submit" value="Add to queue"></input>
        </form>
        <script>
            const clickCounts = {}; // To store click counts for each pizza type
            let orderCount = 0; // To store the order number
            const pizzas = [];
        
            function addToQueue(pizzaType) {
                if (clickCounts[pizzaType]) {
                    clickCounts[pizzaType]++;
                } else {
                    clickCounts[pizzaType] = 1;
                }
        
                orderCount++; // Increment the order count
        
                const qtyInput = document.querySelector('input[name="Qty"]');
                qtyInput.value = clickCounts[pizzaType];
        
                const pizzaNameInput = document.querySelector('input[name="type"]');
                pizzaNameInput.value = pizzaType;
        
                const orderNumberInput = document.querySelector('input[name="order_number"]');
                orderNumberInput.value = orderCount;
        
                // Add the item to the queue table
                addToQueueTable(orderCount, pizzaType, clickCounts[pizzaType]);
            }
        
            function removeFromQueue(orderNumber) {
                // Find the index of the order with the specified order number
                const index = pizzas.findIndex((order) => order.orderNumber === orderNumber);
                if (index !== -1) {
                    // Remove the order from the queue
                    pizzas.splice(index, 1);
                    updateQueueTable();
                }
            }
        
            // Helper function to add an item to the queue table
            function addToQueueTable(orderNumber, pizzaType, qty) {
                const queueTable = document.querySelector('.queue table');
                const tbody = queueTable.querySelector('tbody');
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${orderNumber}</td>
                    <td>${pizzaType}</td>
                    <td>${qty}</td>
                    <td>Pending</td> <!-- Add "Pending" status here -->
                    <td><button onclick="removeFromQueue(${orderNumber})">Remove</button></td>`;
                tbody.appendChild(row);
                // Store the order details in the 'pizzas' array
                pizzas.push({ orderNumber, type: pizzaType, qty, status: "Pending" });
            }
        
            function updateQueueTable() {
                const queueTable = document.querySelector('.queue table');
                const tbody = queueTable.querySelector('tbody');
                // Clear the existing table rows
                while (tbody.firstChild) {
                    tbody.removeChild(tbody.firstChild);
                }
                // Rebuild the table with updated data
                pizzas.forEach((order) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.orderNumber}</td>
                        <td>${order.type}</td>
                        <td>${order.qty}</td>
                        <td>${order.status}</td>
                        <td><button onclick="removeFromQueue(${order.orderNumber})">Remove</button></td>
                    `;
                    tbody.appendChild(row);
                });
            }
        </script>
        
        
    </body>
</html>